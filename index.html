<script type="module">
// 1. IMPORTS CORREGIDOS (Todos arriba)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { 
    getFirestore, 
    doc, 
    setDoc, 
    getDoc, 
    getDocs, // <-- Importante: agregado aquí
    addDoc, 
    collection, 
    onSnapshot, 
    query, 
    where, 
    limit, 
    updateDoc 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBXqBGXf8vOzPnbO7MDKEmhdvJsA3sFczA",
    authDomain: "sistema-grupo-privado.firebaseapp.com",
    projectId: "sistema-grupo-privado",
    storageBucket: "sistema-grupo-privado.firebasestorage.app",
    messagingSenderId: "86750167453",
    appId: "1:86750167453:web:165ff3a605105d525c6f74"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let rolActual = null;
let userEmail = "";

// --- LÓGICA DE RECLAMO CORREGIDA ---
window.reclamarCuenta = async () => {
    const plat = document.getElementById("selectPlataformaUser").value;
    
    // Consulta para buscar cuenta disponible
    const q = query(
        collection(db, "inventario"), 
        where("plataforma", "==", plat), 
        where("estado", "==", "disponible"),
        limit(1)
    );

    try {
        const snap = await getDocs(q); // Uso correcto de getDocs

        if (snap.empty) {
            alert("¡Lo sentimos! No hay stock disponible para " + plat);
            return;
        }

        const docCuenta = snap.docs[0];
        const datosCerrados = docCuenta.data().cuenta;

        // Marcar como entregada
        await updateDoc(doc(db, "inventario", docCuenta.id), {
            estado: "entregada",
            entregadaA: userEmail,
            fechaEntrega: new Date().toLocaleString()
        });

        // Registrar la entrega
        await addDoc(collection(db, "entregas"), {
            plataforma: plat,
            cuenta: datosCerrados,
            usuario: userEmail,
            fecha: new Date().toLocaleString()
        });

        // Mostrar al usuario
        document.getElementById("displayCuenta").style.display = "block";
        document.getElementById("cuentaTexto").innerText = datosCerrados;
        
    } catch (error) {
        console.error("Error al reclamar:", error);
        alert("Hubo un error al procesar tu solicitud.");
    }
};

// ... Resto de tus funciones (login, logout, cargarSelects) igual que antes
</script>
