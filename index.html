<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Andy - Sistema Autom√°tico v6</title>
    <style>
        :root { --primary: #1e293b; --accent: #3b82f6; --danger: #ef4444; --success: #22c55e; --warning: #f59e0b; --text: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: var(--text); margin: 0; padding-bottom: 50px; }
        
        /* LOGIN */
        #login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: var(--primary); padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; border: 2px solid var(--accent); }

        /* NAV */
        .navbar { display: flex; background: var(--primary); padding: 10px; gap: 5px; position: sticky; top: 0; z-index: 1000; overflow-x: auto; border-bottom: 2px solid var(--accent); }
        .nav-btn { background: #334155; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; flex: 1; font-size: 0.7rem; }
        .nav-btn.active { background: var(--accent); }
        .btn-logout { background: var(--danger) !important; }

        .container { padding: 15px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        
        /* TABLAS Y BOTONES */
        table { width: 100%; border-collapse: collapse; background: white; color: #333; border-radius: 8px; overflow: hidden; font-size: 0.8rem; }
        th { background: #1e2d3b; color: white; padding: 10px; }
        td { border-bottom: 1px solid #ddd; padding: 8px; text-align: center; }
        
        input, select, textarea { background: #0f172a; border: 1px solid #475569; color: white; padding: 10px; border-radius: 5px; width: 100%; margin-bottom: 10px; }
        .btn-add { background: var(--success); color: white; width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .action-btn { padding: 6px 10px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 0.7rem; font-weight: bold; }
        
        .status-badge { padding: 3px 6px; border-radius: 4px; font-weight: bold; }
        .disponible { background: var(--success); color: white; }
        .agotado { background: var(--danger); color: white; }
        
        /* BARRA DE PROGRESO CUPO */
        .cupo-bar-bg { background: #eee; height: 10px; border-radius: 5px; width: 100%; margin-top: 5px; }
        .cupo-bar-fill { background: var(--accent); height: 10px; border-radius: 5px; transition: 0.3s; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="color:var(--accent)">üõ°Ô∏è ADMIN ANDY</h2>
        <input type="email" id="login-email" placeholder="andyobregon799@gmail.com">
        <input type="password" id="login-pass" placeholder="Clave">
        <button class="btn-add" onclick="verificarLogin()">ENTRAR</button>
    </div>
</div>

<div id="main-content" style="display:none;">
    <div class="navbar">
        <button class="nav-btn active" onclick="showTab('tab-historial')">üïí LOG</button>
        <button class="nav-btn" onclick="showTab('tab-socios')">üë• SOCIOS</button>
        <button class="nav-btn" onclick="showTab('tab-stock')">üì¶ STOCK</button>
        <button class="nav-btn" onclick="showTab('tab-resumen')">üìä TOTAL</button>
        <button class="nav-btn btn-logout" onclick="cerrarSesion()">‚úñÔ∏è SALIR</button>
    </div>

    <div class="container">
        <div id="tab-resumen" class="section">
            <div class="card">
                <h3>üìä Gesti√≥n de Cupos Autom√°tica</h3>
                <table id="tabla-resumen">
                    <thead>
                        <tr>
                            <th>Plataforma</th>
                            <th>Cuenta</th>
                            <th>Uso (Cupos)</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="body-resumen"></tbody>
                </table>
            </div>
        </div>

        <div id="tab-stock" class="section">
            <div class="card">
                <h3>‚ûï Cargar Cuenta</h3>
                <input type="text" id="stock-correo" placeholder="Correo">
                <input type="text" id="stock-clave" placeholder="Clave">
                <select id="stock-plat"><option>Netflix</option><option>Disney+</option><option>IPTV</option></select>
                <button class="btn-add" onclick="agregarStock()">GUARDAR</button>
            </div>
        </div>

        <div id="tab-historial" class="section active">
            <div class="card">
                <h3>Historial</h3>
                <div id="historial-lista" style="font-size: 0.7rem;"></div>
            </div>
        </div>
        
        <div id="tab-socios" class="section">
            <div class="card">
                <h3>Socios</h3>
                <table id="tabla-socios"><thead><tr><th>Nombre</th><th>Estado</th></tr></thead><tbody id="body-socios"></tbody></table>
            </div>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('andy_final_v6')) || {
        historial: [], 
        stock: [], 
        socios: [{nombre: "Andy Obregon", correo: "andyobregon799@gmail.com", pass: "123456", estado: true}],
        usadas: 0
    };

    function save() { localStorage.setItem('andy_final_v6', JSON.stringify(db)); renderAll(); }

    function verificarLogin() {
        let c = document.getElementById('login-email').value;
        let p = document.getElementById('login-pass').value;
        if(c === "andyobregon799@gmail.com" && p === "123456") {
            document.getElementById('login-overlay').style.display='none';
            document.getElementById('main-content').style.display='block';
        } else { alert("Error"); }
    }

    function cerrarSesion() { location.reload(); }

    function agregarStock() {
        let c = document.getElementById('stock-correo').value;
        let p = document.getElementById('stock-clave').value;
        let plt = document.getElementById('stock-plat').value;
        if(c && p) {
            db.stock.push({ plat: plt, cuenta: `${c}:${p}`, cupo: 0, max: 8 });
            db.historial.unshift(`[${new Date().toLocaleTimeString()}] Nueva cuenta ${plt}`);
            save();
        }
    }

    // FUNCI√ìN CLAVE: ENTREGAR CUPO
    function entregarCupo(i) {
        if(db.stock[i].cupo < db.stock[i].max) {
            db.stock[i].cupo++;
            db.historial.unshift(`[${new Date().toLocaleTimeString()}] Cupo entregado: ${db.stock[i].plat}`);
            if(db.stock[i].cupo === db.stock[i].max) {
                alert(`¬°ATENCI√ìN! La cuenta de ${db.stock[i].plat} se ha agotado (8/8).`);
            }
            save();
        } else {
            alert("Esta cuenta ya est√° agotada. Selecciona otra.");
        }
    }

    function resetCupo(i) {
        db.stock[i].cupo = 0;
        db.historial.unshift(`[${new Date().toLocaleTimeString()}] Cupo reseteado: ${db.stock[i].plat}`);
        save();
    }

    function borrarStock(i) {
        db.stock.splice(i, 1);
        save();
    }

    function showTab(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function renderAll() {
        // Historial
        document.getElementById('historial-lista').innerHTML = db.historial.slice(0,10).map(h => `<div>${h}</div>`).join('');
        
        // Resumen Detallado
        document.getElementById('body-resumen').innerHTML = db.stock.map((s, i) => {
            let porcentaje = (s.cupo / s.max) * 100;
            let estadoClase = s.cupo >= s.max ? 'agotado' : 'disponible';
            let estadoTexto = s.cupo >= s.max ? 'AGOTADO' : 'DISPONIBLE';

            return `
                <tr>
                    <td><b>${s.plat}</b></td>
                    <td><small>${s.cuenta}</small></td>
                    <td>
                        ${s.cupo} / ${s.max}
                        <div class="cupo-bar-bg"><div class="cupo-bar-fill" style="width:${porcentaje}%"></div></div>
                        <span class="status-badge ${estadoClase}">${estadoTexto}</span>
                    </td>
                    <td>
                        <button class="action-btn" style="background:var(--success)" onclick="entregarCupo(${i})">VENDER</button>
                        <button class="action-btn" style="background:var(--warning)" onclick="resetCupo(${i})">RESET</button>
                        <button class="action-btn" style="background:var(--danger)" onclick="borrarStock(${i})">X</button>
                    </td>
                </tr>
            `;
        }).join('');

        // Socios
        document.getElementById('body-socios').innerHTML = db.socios.map(s => `<tr><td>${s.nombre}</td><td>ON</td></tr>`).join('');
    }

    renderAll();
</script>

</body>
</html>
