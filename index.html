<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administrativo - Andy Obreg√≥n</title>
    <style>
        :root { --primary: #1e293b; --accent: #3b82f6; --danger: #ef4444; --success: #22c55e; --warning: #f59e0b; --text: #f8fafc; }
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: var(--text); margin: 0; padding-bottom: 50px; }
        
        button:active { transform: scale(0.95); opacity: 0.8; }
        
        #login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:#0f172a; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-box { background: var(--primary); padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; border: 2px solid var(--accent); }
        
        .navbar { display: flex; background: var(--primary); padding: 10px; gap: 5px; position: sticky; top: 0; z-index: 1000; overflow-x: auto; border-bottom: 2px solid var(--accent); }
        .nav-btn { background: #334155; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; white-space: nowrap; flex: 1; font-size: 0.75rem; }
        .nav-btn.active { background: var(--accent); }
        .btn-logout { background: var(--danger) !important; color: white; }
        
        .container { padding: 10px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: #1e293b; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #334155; }
        
        .table-container { width: 100%; overflow-x: auto; background: white; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; color: #333; min-width: 650px; }
        th { background: #1e2d3b; color: white; padding: 12px; font-size: 0.75rem; text-transform: uppercase; }
        td { border-bottom: 1px solid #eee; padding: 10px; font-size: 0.8rem; text-align: center; }
        
        input, select, textarea { background: #0f172a; border: 1px solid #475569; color: white; padding: 10px; border-radius: 5px; width: 100%; margin-bottom: 10px; box-sizing: border-box; }
        .btn-add { background: var(--success); color: white; width: 100%; padding: 12px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .action-btn { padding: 6px 10px; border: none; border-radius: 4px; color: white; cursor: pointer; font-size: 0.7rem; font-weight: bold; margin: 2px; }
        
        .item-list { background: #334155; padding: 10px; border-radius: 5px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }

        #display-entrega { display: none; margin-top: 20px; padding: 15px; border: 2px solid var(--success); border-radius: 8px; background: #f0fdf4; color: #166534; text-align: center; }
        .cuenta-box { background: white; border: 2px dashed #22c55e; padding: 15px; margin: 10px 0; font-family: monospace; font-size: 1rem; color: #333; word-break: break-all; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="color:var(--accent)">üõ°Ô∏è PANEL ANDY</h2>
        <input type="email" id="login-email" placeholder="Correo">
        <input type="password" id="login-pass" placeholder="Clave">
        <button class="btn-add" onclick="verificarLogin()">ENTRAR</button>
    </div>
</div>

<div id="main-content" style="display:none;">
    <div class="navbar" id="barra-nav"></div>

    <div class="container">
        <div id="tab-usuario" class="section">
            <div class="card">
                <h3>üéÅ Obtener mi Cuenta al Instante</h3>
                <select id="user-select-miembro"></select>
                <select id="user-select-plat"></select>
                <button class="btn-add" style="background:var(--success)" onclick="usuarioPideCuenta()">üöÄ RECLAMAR CUENTA AHORA</button>
                <div id="display-entrega">
                    <div style="font-weight: bold;">‚úÖ ENTREGA EXITOSA:</div>
                    <div class="cuenta-box" id="texto-cuenta"></div>
                    <button class="action-btn" style="background:#1e293b; padding:10px 20px;" onclick="copiarTodo()">üìã COPIAR TODO</button>
                </div>
            </div>
        </div>

        <div id="tab-historial" class="section active">
            <div class="card">
                <h3>üìú Registro Completo</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr><th>Fecha</th><th>Hora</th><th>Socio</th><th>Miembro</th><th>Plataforma</th></tr>
                        </thead>
                        <tbody id="historial-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-vip" class="section">
            <div class="card">
                <h3>üíé Miembros VIP</h3>
                <textarea id="input-masivo-vip" rows="4" placeholder="Nombre - Numero..."></textarea>
                <button class="btn-add" onclick="cargarVipMasivo()">A√ëADIR A LA LISTA</button>
            </div>
            <div id="lista-vip-despliegue"></div>
        </div>

        <div id="tab-socios" class="section">
            <div class="card">
                <h3>üë• Gesti√≥n de Accesos</h3>
                <input type="text" id="soc-nom" placeholder="Nombre">
                <input type="email" id="soc-cor" placeholder="Correo">
                <input type="text" id="soc-pas" placeholder="Contrase√±a">
                <select id="soc-rol"><option value="Admin">Admin</option><option value="Socio">Socio</option><option value="Usuario">Usuario</option></select>
                <button class="btn-add" onclick="agregarSocio()">GUARDAR SOCIO</button>
            </div>
            <div class="table-container"><table style="background:white;"><thead><tr><th>Nombre</th><th>Correo</th><th>Pass</th><th>Rol</th><th>Estado</th><th>Acci√≥n</th></tr></thead><tbody id="socios-body"></tbody></table></div>
        </div>

        <div id="tab-stock" class="section">
            <div class="card">
                <h3>üõ†Ô∏è Gestionar Plataformas</h3>
                <input type="text" id="nueva-plat-nombre" placeholder="Nombre de Plataforma (Ej: Netflix)">
                <button class="btn-add" style="background:var(--accent)" onclick="crearPlat()">+ CREAR PLATAFORMA</button>
                <div id="lista-plataformas-edit" style="margin-top:10px;"></div>
            </div>
            <div class="card">
                <h3>üì¶ A√±adir Cuentas al Stock</h3>
                <input type="text" id="st-cor" placeholder="Correo Cuenta">
                <input type="text" id="st-cla" placeholder="Clave Cuenta">
                <select id="st-plat-select"></select>
                <button class="btn-add" onclick="agregarStock()">GUARDAR EN INVENTARIO</button>
            </div>
        </div>

        <div id="tab-resumen" class="section">
            <div class="card">
                <h3>üìä Resumen Stock (0/8)</h3>
                <div class="table-container">
                    <table>
                        <thead><tr><th>Plat</th><th>Cuenta</th><th>Cupos</th><th>Acciones</th></tr></thead>
                        <tbody id="body-resumen"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let session = { user: null };
    let db = JSON.parse(localStorage.getItem('andy_v18_final')) || {
        historial: [], vip: [], stock: [], plataformas: ["Netflix", "Disney+"],
        socios: [{nombre: "Andy Obregon", correo: "andyobregon799@gmail.com", pass: "123456", rol: "Admin", estado: true}]
    };

    function save() { localStorage.setItem('andy_v18_final', JSON.stringify(db)); renderAll(); }

    function verificarLogin() {
        let c = document.getElementById('login-email').value;
        let p = document.getElementById('login-pass').value;
        let u = db.socios.find(x => x.correo === c && x.pass === p && x.estado === true);
        if(u) {
            session.user = u;
            document.getElementById('login-overlay').style.display='none';
            document.getElementById('main-content').style.display='block';
            configurarNav(u.rol);
        } else { alert("Datos incorrectos"); }
    }

    function configurarNav(rol) {
        let nav = document.getElementById('barra-nav');
        let btns = '';
        if(rol === 'Admin' || rol === 'Socio') {
            btns = `<button class="nav-btn active" onclick="showTab('tab-historial')">üïí HISTORIAL</button>
                    <button class="nav-btn" onclick="showTab('tab-vip')">üíé VIP</button>
                    <button class="nav-btn" onclick="showTab('tab-socios')">üë• SOCIOS</button>
                    <button class="nav-btn" onclick="showTab('tab-stock')">üì¶ STOCK</button>
                    <button class="nav-btn" onclick="showTab('tab-resumen')">üìä TOTAL</button>`;
        } else { btns = `<button class="nav-btn active" onclick="showTab('tab-usuario')">üì• PEDIR</button>`; }
        btns += `<button class="nav-btn btn-logout" onclick="location.reload()">‚úñÔ∏è SALIR</button>`;
        nav.innerHTML = btns;
        showTab(rol === 'Usuario' ? 'tab-usuario' : 'tab-historial');
    }

    function usuarioPideCuenta() {
        let m = document.getElementById('user-select-miembro').value;
        let p = document.getElementById('user-select-plat').value;
        let sIdx = db.stock.findIndex(s => s.plat === p && s.cupo < 8);
        if(sIdx !== -1) {
            db.stock[sIdx].cupo++;
            let d = new Date();
            db.historial.unshift({ fecha: d.toLocaleDateString(), hora: d.toLocaleTimeString(), socio: session.user.nombre, miembro: m, plat: p });
            document.getElementById('texto-cuenta').innerText = db.stock[sIdx].cuenta;
            document.getElementById('display-entrega').style.display = 'block';
            save();
        } else { alert("Sin Stock disponible"); }
    }

    function copiarTodo() { navigator.clipboard.writeText(document.getElementById('texto-cuenta').innerText); alert("Copiado"); }
    function cargarVipMasivo() { let t = document.getElementById('input-masivo-vip').value; if(t){ t.split('\n').forEach(l => { if(l.trim()) db.vip.push(l.trim()); }); document.getElementById('input-masivo-vip').value=""; save(); } }
    
    // FUNCIONES DE PLATAFORMA
    function crearPlat() { let n = document.getElementById('nueva-plat-nombre').value; if(n){ db.plataformas.push(n); document.getElementById('nueva-plat-nombre').value=""; save(); } }
    function eliminarPlat(idx) { if(confirm("¬øEliminar plataforma?")){ db.plataformas.splice(idx,1); save(); } }

    function agregarStock() { let c = document.getElementById('st-cor').value; let k = document.getElementById('st-cla').value; let p = document.getElementById('st-plat-select').value; if(c&&k){ db.stock.push({plat:p, cuenta:`${c}:${k}`, cupo:0}); save(); } }
    function agregarSocio() { 
        let n = document.getElementById('soc-nom').value; let c = document.getElementById('soc-cor').value; let p = document.getElementById('soc-pas').value; let r = document.getElementById('soc-rol').value;
        if(n&&c&&p){ db.socios.push({nombre:n, correo:c, pass:p, rol:r, estado:true}); save(); } 
    }
    
    function showTab(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

    function renderAll() {
        document.getElementById('historial-body').innerHTML = db.historial.map(h => `<tr><td>${h.fecha}</td><td>${h.hora}</td><td>${h.socio}</td><td>${h.miembro}</td><td><b>${h.plat}</b></td></tr>`).join('');
        document.getElementById('socios-body').innerHTML = db.socios.map((s, i) => `<tr><td>${s.nombre}</td><td>${s.correo}</td><td>${s.pass}</td><td>${s.rol}</td><td style="color:${s.estado?'green':'red'}"><b>${s.estado?'ON':'OFF'}</b></td><td><button class="action-btn" style="background:var(--accent)" onclick="db.socios[${i}].estado=!db.socios[${i}].estado;save()">ON/OFF</button></td></tr>`).join('');
        
        // Render Plataformas en Stock
        document.getElementById('lista-plataformas-edit').innerHTML = db.plataformas.map((p, i) => `<div class="item-list"><span>${p}</span><button class="action-btn" style="background:var(--danger)" onclick="eliminarPlat(${i})">X</button></div>`).join('');

        document.getElementById('lista-vip-despliegue').innerHTML = db.vip.map((v, i) => `<div class="member-item"><span>${v}</span><div><button class="action-btn" style="background:orange" onclick="let n=prompt('Edit',db.vip[${i}]);if(n){db.vip[${i}]=n;save()}">EDITAR</button><button class="action-btn" style="background:red" onclick="db.vip.splice(${i},1);save()">X</button></div></div>`).join('');
        
        let pOpts = db.plataformas.map(p => `<option value="${p}">${p}</option>`).join('');
        document.getElementById('st-plat-select').innerHTML = pOpts;
        document.getElementById('user-select-plat').innerHTML = pOpts;
        document.getElementById('user-select-miembro').innerHTML = db.vip.map(v => `<option value="${v}">${v}</option>`).join('');
        
        // Render Stock con bot√≥n EDITAR
        document.getElementById('body-resumen').innerHTML = db.stock.map((s, i) => `<tr><td>${s.plat}</td><td><small>${s.cuenta}</small></td><td>${s.cupo}/8</td><td>
            <button class="action-btn" style="background:orange" onclick="let nc=prompt('Nueva cuenta (correo:clave)',db.stock[${i}].cuenta); if(nc){db.stock[${i}].cuenta=nc;save()}">EDITAR</button>
            <button class="action-btn" style="background:var(--warning)" onclick="db.stock[${i}].cupo=0;save()">RESET</button>
            <button class="action-btn" style="background:var(--danger)" onclick="db.stock.splice(${i},1);save()">X</button>
        </td></tr>`).join('');
    }
    renderAll();
</script>
</body>
</html>
